#!/bin/bash

DOTFILES=$(pwd)
PREZTO="${HOME}/.zprezto"

link_file() {
  if [ ! -f ~/${1} ] && [ ! -d ~/${1} ]; then
    ln -s $DOTFILES/$1 ~/$1
    echo "$1 linked"
  else
    echo "$1 already linked, skipping."
  fi
}

create_symlinks() {
  files=(.gitconfig .gitignore_global .tmux.conf .vimrc .zshrc .tmux .ssh/config)

  for file in "${files[@]}"; do
    link_file $file
  done
}

install_prezto() {
  if [ -d "${PREZTO}" ]; then
    cd "${PREZTO}"
    echo "Changed directory to $(pwd)"
    echo "${PREZTO} exists, running Git pull to update..."
    git stash
    git pull
    git stash pop
    cd - >/dev/null 2>&1
    echo "changed directory back to $(pwd)"
  else
    echo "${PREZTO} is not installed. Installing..."
    echo "Making sure we are using zsh"
    zsh
    git clone --recursive https://github.com/sorin-ionescu/prezto.git "${ZDOTDIR:-$HOME}/.zprezto"
    echo "Setting the default shell to zsh"
    chsh -s /bin/zsh
  fi
}

install_vim_plug() {
  if [ -f ~/.vim/autoload/plug.vim ]; then
    echo "Vim Plug already installed"
  else
    echo "Vim Plug not installed. Installing..."
    curl -fLo ~/.vim/autoload/plug.vim --create-dirs \
      https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
  fi
}

main() {
  install_prezto
  install_vim_plug
  create_symlinks
}

main
